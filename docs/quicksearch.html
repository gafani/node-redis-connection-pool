<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"redis_pool.js.html":{"id":"redis_pool.js.html","title":"Source: redis_pool.js","body":" simple-redis-pool Classes RedisPool Source: redis_pool.js &quot;use strict&quot;; const genericPool = require(&quot;generic-pool&quot;); const retry = require(&quot;retry-as-promised&quot;); const pick = require(&quot;lodash.pick&quot;); const redis = require(&quot;./redis&quot;); const debug = require(&quot;debug&quot;)(&quot;simpleRedisPool&quot;); const create = function (redisOptions) { return new Promise((resolve, reject) =&gt; { debug(&quot;Start redis createClient&quot;, redisOptions); const client = redis.createClient(redisOptions); client.on(&quot;error&quot;, err =&gt; { debug(&quot;Failed redis createClient&quot;, err); reject(err); }); client.on(&quot;connect&quot;, () =&gt; { debug(&quot;Succeeded redis createClient&quot;, redisOptions); resolve(client); }); }); }; const selectDB = function (client, db) { return new Promise((resolve, reject) =&gt; { client.select(db, function (err) { if (err) reject(err); debug(&quot;DB selected: &quot;, db); resolve(client); }); }); }; /** * Takes a number and returns its square value * @constructor * @param {Object} options - init parans * @property {String} options.name * @property {String} options.redisOptions * @property {String} options.poolOptions * @property {Object} options.logger */ const RedisPool = module.exports = function (options) { options = pick(options, [&quot;name&quot;, &quot;redisOptions&quot;, &quot;poolOptions&quot;, &quot;logger&quot;]); this.name = options.name || `redisPool-${Math.random().toString(36).substr(2, 10)}`; this.redisOptions = options.redisOptions; this.poolOptions = options.poolOptions; this.logger = require(&quot;./logger&quot;)(options.logger); // for retry let createAttempts = 0; const factory = { create: () =&gt; { // this is due to the limitation of node-pool ATM // https://github.com/coopernurse/node-pool/issues/161#issuecomment-261109882 return retry(function () { createAttempts++; if (createAttempts &gt; 3) { const err = new Error(&quot;CONN_FAILED&quot;); debug(&quot;Max conn createAttempts reached: %s, resolving to error:&quot;, createAttempts, err); // reset for next try createAttempts = 0; return Promise.resolve(err); } return create(options.redisOptions); }, { max: 10, name: &quot;factory.create&quot;, report: debug }); }, destroy: (client) =&gt; { return new Promise((resolve) =&gt; { try { // Flush when closing. client.end(true, () =&gt; resolve()); debug(&quot;Client conn closed. Available count : %s. Pool size: %s&quot;, this.availableObjectsCount(), this.getPoolSize()); this.logger.log(&quot;Client conn closed. Available count : %s. Pool size: %s&quot;, this.availableObjectsCount(), this.getPoolSize()); } catch (err) { debug(&quot;Failed to destroy connection&quot;, err); this.logger.error(&quot;Failed to destroy connection&quot;, err); // throw error cause infinite event loop; limitation of node-pool // throw err; } }); } }; // Now that the pool settings are ready create a pool instance. debug(&quot;Creating pool&quot;, this.poolOptions); this.pool = genericPool.createPool(factory, this.poolOptions); this.pool.on(&quot;factoryCreateError&quot;, e =&gt; { debug(&quot;Errored while connecting Redis&quot;, e); this.logger.error(&quot;Errored while connecting Redis&quot;, e); }); this.pool.on(&quot;factoryDestroyError&quot;, e =&gt; { debug(&quot;Errored while destroying Redis conn&quot;, e); this.logger.error(&quot;Errored while destroying Redis conn&quot;, e); }); }; RedisPool.prototype.sendCommand = function (commandName, commandArgs) { return this.pool.acquire() .then(conn =&gt; { commandArgs = [].concat(commandArgs || []); debug(&quot;Executing send_commandAsync&quot;, commandName, commandArgs); return (commandArgs.length &gt; 0 ? conn.send_commandAsync(commandName, commandArgs) : conn.send_commandAsync(commandName) ) .then(result =&gt; { this.pool.release(conn); return result; }) .catch(err =&gt; { this.pool.release(conn); this.logger.error(&quot;Errored send_command&quot;, err); debug(&quot;Errored send_command&quot;, err); throw err; }); }); }; // Acquire a database connection and use an optional priority. RedisPool.prototype.acquire = function (priority, db) { return this.pool.acquire(priority) .then(client =&gt; { if (client instanceof Error) { debug(&quot;Couldn't acquire connection to %j&quot;, this.redisOptions); this.logger.error(&quot;Couldn't acquire connection to %j&quot;, this.redisOptions); throw client; } if (db) { this.logger.info(&quot;select DB:&quot;, db); return selectDB(client, db); } else { return client; } }); }; // Release a database connection to the pool. RedisPool.prototype.release = function (client) { return this.pool.release(client); }; RedisPool.prototype.destroy = function (client) { return this.pool.destroy(client); }; // Drains the connection pool and call the callback id provided. RedisPool.prototype.drain = function () { return this.pool.drain(() =&gt; this.pool.clear()); }; // Returns factory.name for this pool RedisPool.prototype.getName = function () { return this.name; }; RedisPool.prototype.getRedisOptions = function () { return this.redisOptions; }; RedisPool.prototype.getPoolOptions = function () { return this.poolOptions; }; RedisPool.prototype.getPoolSize = function () { return this.pool.size; }; RedisPool.prototype.availableObjectsCount = function () { return this.pool.available; }; RedisPool.prototype.waitingClientsCount = function () { return this.pool.pending; }; RedisPool.prototype.status = function () { return { name: this.name, size: this.pool.size, available: this.pool.available, waiting: this.pool.pending }; }; × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" simple-redis-pool Classes RedisPool Classes Classes RedisPool × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" simple-redis-pool Classes RedisPool simple-redis-poolRedis pool ready to scale with node-pool support Prerequisitesnode &gt;= 4 This module requires nodejs v4 or above as it has dependencies on es6 components such as Map, Set, Promise etc. Getting started npm install simple-redis-pool Usage var RedisPool = require(&quot;simple-redis-pool&quot;); var pool = new RedisPool(); pool.acquire() .then(conn =&gt; { // Do some work // At the end release the conn back to the pool pool.release(conn) }); API RedisPool([options]) options object properties Property Default Description name Random unique string Name your pool redisOptions {url: redis://127.0.0.1:6379} opts from https://github.com/NodeRedis/node_redis#options-object-properties poolOptions null opts from https://github.com/coopernurse/node-pool#createpool logger null Inject your custom logger Run testsbash test.shContributeDiscover how you can contribute by heading on over to the CONTRIBUTING.md file. Backers MaintainersThese amazing people are maintaining this project: Phani — view contributions SponsorsNo sponsors yet! Will you be the first? ContributorsThese amazing people have contributed to/reviewed this project: Oliver Brooks Discover how you can contribute by heading on over to the CONTRIBUTING.md file. × Search results Close "},"RedisPool.html":{"id":"RedisPool.html","title":"Class: RedisPool","body":" simple-redis-pool Classes RedisPool Class: RedisPool RedisPool new RedisPool(options) Takes a number and returns its square value Parameters: Name Type Description options Object init parans Properties: Name Type Description options.name String options.redisOptions String options.poolOptions String options.logger Object Source: redis_pool.js × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
